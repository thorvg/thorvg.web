<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ThorVG Worker Player Example</title>
  <meta name="description" content="A web lottie player using ThorVG with Web Workers" />
  <script type="module" src="../dist/lottie-player-worker.js"></script>
</head>
<body>
  <div>
    <div>
      <button onclick="playAnimation()">Play</button>
      <button onclick="pauseAnimation()">Pause</button>
      <button onclick="stopAnimation()">Stop</button>
      <button onclick="createAnimation()">Create</button>
      <button onclick="destroyAnimation()">Destroy</button>
      
      <div>
        <label for="loopCheckbox">Loop</label>
        <input type="checkbox" id="loopCheckbox" onchange="toggleLoop(event)" checked>
      </div>
      
      <div>
        <label for="speedRange">Speed</label>
        <input type="range" id="speedRange" min="0.1" max="2" step="0.1" value="1" onchange="changeSpeed(this.value)">
      </div>
      
      <div>
        <label for="frameRange">Frame</label>
        <input type="range" id="frameRange" min="1" max="100" step="1" value="1" onchange="seekFrame(this.value)">
      </div>
      
      <input type="text" id="animationUrl" placeholder="Animation URL" value="https://lottie.host/6d7dd6e2-ab92-4e98-826a-2f8430768886/NGnHQ6brWA.json"/>
    </div>

    <div id="thorvg-container"></div>
  </div>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    
    button {
      margin: 5px;
      padding: 8px 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    button:hover {
      background-color: #0056b3;
    }
    
    #thorvg-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    input[type="range"] {
      width: 200px;
      margin: 0 10px;
    }
    
    label {
      margin-right: 10px;
    }
    
    #animationUrl {
      width: 400px;
      padding: 8px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>

  <script type="module">

    let player = null;
    let animationCount = 0;

    async function createAnimation() {
      const container = document.getElementById('thorvg-container');
      const animation = document.createElement('lottie-player-worker');
      animation.wasmUrl = "../dist/thorvg-wasm.wasm"
      
      animation.style.width = '400px';
      animation.style.height = '400px';
      animation.style.border = '1px solid #ccc';
      animation.autoPlay = true;
      animation.loop = true;
      animation.src = "https://lottie.host/6d7dd6e2-ab92-4e98-826a-2f8430768886/NGnHQ6brWA.json";
      
      container.appendChild(animation);

      try {
        player = animation;

        player.addEventListener('load', (event) => {
          console.log('Animation loaded:', event);
        });

        player.addEventListener('play', (event) => {
          console.log('Animation playing:', event);
        });

        player.addEventListener('pause', (event) => {
          console.log('Animation paused:', event);
        });

        player.addEventListener('stop', (event) => {
          console.log('Animation stopped:', event);
        });

        player.addEventListener('complete', (event) => {
          console.log('Animation completed:', event);
        });

        player.addEventListener('frame', (event) => {
          console.log('Frame update:', event);
        });

        player.addEventListener('error', (event) => {
          console.error('Animation error:', event);
        });

        const url = document.getElementById('animationUrl').value;
        // await animation.load(url, 'json');

        console.log('Animation created successfully');
      } catch (error) {
        console.error('Failed to create animation:', error);
      }
    }

    async function playAnimation() {
      if (player) {
        await player.play();
      }
    }

    async function pauseAnimation() {
      if (player) {
        await player.pause();
      }
    }

    async function stopAnimation() {
      if (player) {
        await player.stop();
      }
    }

    async function destroyAnimation() {
      if (player) {
        await player.destroy();
        player = null;
        
        const container = document.getElementById('thorvg-container');
        container.innerHTML = '';
      }
    }

    async function toggleLoop(event) {
      if (player) {
        await player.setLoop(event.target.checked);
      }
    }

    async function changeSpeed(value) {
      if (player) {
        await player.setSpeed(parseFloat(value));
      }
    }

    async function seekFrame(value) {
      if (player) {
        await player.seek(parseInt(value));
      }
    }
    for(let i = 0; i < 10; i ++) {
      createAnimation();
    }

    window.createAnimation = createAnimation;
    window.playAnimation = playAnimation;
    window.pauseAnimation = pauseAnimation;
    window.stopAnimation = stopAnimation;
    window.destroyAnimation = destroyAnimation;
    window.toggleLoop = toggleLoop;
    window.changeSpeed = changeSpeed;
    window.seekFrame = seekFrame;
  </script>
</body>
</html>